---
# Hub cluster configuration (Management cluster with ACM/MCE)
# Inherits from: values-home.yaml (cluster set) + values-hub.yaml (topology)
# Mapped from roles/hub/templates/*.yaml

# Include cluster set configuration
# In deployment: helm install -f values-global.yaml -f clusters/sets/values-home.yaml -f clusters/individual-clusters/values-hub.yaml

spec:
  destination:
    server: https://kubernetes.default.svc
  source:
    repoURL: https://github.com/rbales79/argo-apps
    targetRevision: framework-dev

clusterGroup:
  name: hub
  topology: hub  # Multi-node hub cluster
  clusterSet: home
  region: hub
  isHubCluster: true

  # Storage - Hub uses TrueNAS (from base-storage.yaml: truenas enabled)
  storage:
    default:
      provider: truenas
      className: truenas-iscsi
    truenas:
      enabled: true  # Enabled in base-storage.yaml
      iscsi:
        namePrefix: hub-
      zfs:
        datasetParentName: volume1/iscsi/hub/vols
        detachedSnapshotsDatasetParentName: volume1/iscsi/hub/snaps
    synology:
      enabled: false
    metallb:
      enabled: false  # MetalLB commented out in infrastructure.yaml

  # Platform components (from base-apps.yaml)
  platformComponents:
    # Security & Secrets
    externalSecrets:
      enabled: true  # From base-security.yaml
    certManager:
      enabled: true  # certificates in base-apps.yaml

    # Node & Resource Management
    nfd:
      enabled: true  # openshift-nfd in base-apps.yaml
    vpa:
      enabled: true  # vertical-pod-autoscaler in base-apps.yaml
    goldilocks:
      enabled: true  # goldilocks in base-apps.yaml
    systemReservation:
      enabled: false  # Commented out in base-apps.yaml

    # Monitoring & Health
    gatus:
      enabled: true  # gatus in base-apps.yaml
    customErrorPages:
      enabled: true  # custom-error-pages in base-apps.yaml

    # Hardware & GPU
    genericDevicePlugin:
      enabled: true  # generic-device-plugin in base-apps.yaml
    amdGpu:
      enabled: true  # amd-gpu-operator in infrastructure.yaml
    intelGpu:
      enabled: false  # Commented out in infrastructure.yaml

    # Backup & HA
    kasten:
      enabled: false  # k10-kasten-operator in base-apps.yaml
    keepalived:
      enabled: true  # keepalived-operator in base-apps.yaml

    # Multi-cluster Management (moved to platform for DRY)
    acm:
      enabled: true  # advanced-cluster-management - can be on any cluster
      version: "2.14.1"
      availabilityConfig: Basic  # Use minimal resources for home lab
    multiclusterEngine:
      enabled: false  # MCE is automatically deployed by ACM - don't deploy separately
      availabilityConfig: Basic  # Use minimal resources for home lab

    # Tweaks (from base-tweaks.yaml)
    argoCdResourceConfig:
      enabled: true
    disableMasterSecondaryInterfaces:
      enabled: false  # Commented out
    disableWorkerSecondaryInterfaces:
      enabled: false  # Commented out
    snapshotFinalizerRemover:
      enabled: true

  # Application stacks - Management cluster (apps typically disabled on hub)
  applicationStacks:
    # AI / ML Applications
    ai:
      enabled: false
      apps:
        # - litellm            # AI proxy/router for LLM APIs
        # - ollama             # Local LLM inference server
        # - open-webui         # Web interface for Ollama/LiteLLM

    # Media Management Applications
    media:
      enabled: false
      apps:
        # - bazarr             # Subtitle management
        # - flaresolverr       # Cloudflare bypass proxy
        # - gaps               # Missing movie finder for Plex
        # - huntarr            # Bounty manager for *arr apps
        # - jellyfin           # Alternative media server
        # - jellyseerr         # Request management for Jellyfin
        # - kapowarr           # Comic book collection manager
        # - kavita             # Ebook/comic reader
        # - lidarr             # Music collection manager
        # - metube             # YouTube downloader
        # - overseerr          # Request management for Plex/Jellyfin
        # - pinchflat          # YouTube channel archiver
        # - plex               # Media server (primary)
        # - posterizarr        # Poster/artwork management
        # - prowlarr           # Indexer manager
        # - radarr             # Movie collection manager
        # - readarr            # Ebook collection manager
        # - recyclarr          # TRaSH guides sync for *arr apps
        # - sabnzbd            # Usenet downloader
        # - sonarr             # TV series collection manager
        # - tautulli           # Plex monitoring and statistics

    # Home Automation Applications
    homeAutomation:
      enabled: false
      apps:
        # - emqx-operator      # MQTT broker operator
        # - home-assistant     # Home automation platform
        # - node-red           # Flow-based automation
        # - zwavejs2mqtt       # Z-Wave to MQTT bridge

    # Productivity Applications
    productivity:
      enabled: true
      apps:
        # - bookmarks        # Bookmark manager
        # - cyberchef        # Data transformation tool
        # - excalidraw       # Collaborative whiteboard
        # - it-tools         # Developer utilities collection
        # - startpunkt       # Customizable startpage
        # - terraform-enterprise  # Terraform private registry
         - todo             # Hierarchical task manager (FastAPI + React)

    # Infrastructure Applications
    infrastructure:
      enabled: true
      apps:
        # - adsb               # Aircraft tracking (FlightAware/ADS-B)
         - glue-worker        # Custom Python automation workers
         - paperless-ai       # AI-powered document processing
         - paperless-gpt      # GPT integration for Paperless
         - paperless-ngx      # Document management system

  # Network configuration for Hub
  network:
    lan:
      defaultGateway: 192.168.1.1
      subnet: 192.168.1.0/24
    loadbalancer-ips:
      plex: 192.168.1.205
      emqx: 192.168.1.204

  # Cluster-specific overrides (from roles/hub/values.yaml)
  cluster:
    top_level_domain: roybales.com
    name: hub
    admin_email: rbales79@gmail.com
    timezone: America/New_York

  # Certificates
  certificates:
    letsencrypt:
      issuer: production

  # External Secrets
  externalSecrets:
    secret: infisical-auth-secret
    infisical:
      projectSlug: hub
      environmentSlug: prod

  # ArgoCD resource configuration
  argocd:
    enabled: true

  # AMD GPU Operator node labeling (Radeon Vega 8 integrated GPU)
  amdGpuOperator:
    nodeLabeling:
      enabled: true
      nodeNames:
        - hub
      additionalLabels:
        amd.com/gpu.family: gfx902
        amd.com/gpu.model: RadeonVega8

  # Managed clusters (for ACM)
  managedClusters:
    - name: prod
      region: edge
      topology: sno
    - name: test
      region: edge
      topology: sno
